# 사용자 요구사항 정의서 (want.md)

이 문서는 사용자(Pollux)가 레시피 추천 시스템에 대해 궁극적으로 원하는 핵심 기능과 동작 방식을 명확히 정의합니다.

## 1. 레시피 추천 핵심 사용자 경험 (UX)
*   **명확한 흐름**: "레시피 추천해드릴까요?" 제안에 "응" 응답 시, 단계를 거쳐 명확하게 레시피가 제공되어야 함.
*   **건강 우선**: 레시피 생성에 앞서 사용자의 건강 상태(질병, 알레르기)와 요청 음식 간의 유해성 판단이 최우선되어야 함.
*   **능동적 선택권**: 유해성 감지 시, 사용자에게 "그대로 진행" 또는 "건강하게 변경"할 수 있는 선택권을 제공해야 함.
*   **단계별 투명성**: 시스템이 내부적으로 무엇을 하고 있는지(예: 건강 확인 중, 레시피 생성 중) 사용자에게 시각적으로 명확하게 알려주어야 함.
*   **재치 및 친근함**: 시스템 메시지(로딩 메시지 포함)는 기존의 재치 있고 친근한 어조를 유지해야 함.

## 2. 성능 요구사항
*   **응답 속도**: "응" 응답 시부터 최종 레시피 제공까지의 총 시간이 **3초 이내**로 단축되어야 함. (LLM 추론 시간 + 기타 백엔드 처리 시간 포함)
*   **불필요한 지연 제거**: LangChain Agent의 "판단" 단계에서 발생하는 불필요한 LLM 추론 시간을 제거해야 함.

## 3. 안전성 및 신뢰성 요구사항
*   **건강 유해성 판단**: AI는 사용자가 원하는 음식과 건강 정보(기저질환, 알레르기)를 기반으로 유해성 여부를 정확히 판단해야 함.
*   **정확한 정보 고지**: 유해성 감지 시, 프론트엔드의 경고 UI(`ChatBubble` 디자인)를 활용하여 알레르기 또는 기저질환 충돌 여부를 사용자에게 명확히 알려야 함.
*   **대화 맥락 유지**: `safety_mode="proceed"` 선택 시에도 사용자 정보(질병, 알레르기 등)와 이전 대화 맥락을 LLM에 온전히 전달하여, 단순 "원본 레시피" 요청이 아닌 "고혈압이지만 지금은 짠 라면 레시피"와 같은 복합적인 의도를 LLM이 이해하고 처리할 수 있어야 함. 즉, 정보를 임의로 필터링하지 않고, 지시를 통해 LLM의 행동을 제어해야 함.

## 4. LLM과의 상호작용 방식
*   **"판단" 대신 "실행"**: LLM은 복잡한 의도 파악이나 유해성 판단(이는 이미 단축 경로에서 처리) 대신, **주어진 지시에 따라 레시피를 생성하는 역할**에 집중해야 함.
*   **명확한 지시**: `safety_mode`에 따라 프롬프트 지시사항이 명확하게 분기되어야 함:
    *   `proceed`: "사용자의 건강 정보를 인지했으나, 사용자가 위험을 감수하고 **원본 레시피**를 원함. 그대로 생성."
    *   `health_first`: "사용자의 건강 정보를 최우선으로, **건강하게 변형된 레시피**를 생성."
*   **효율적인 Context 전달**: `conversation_history` 및 `user`의 모든 건강 관련 `context`는 LLM에 전달하되, 이 정보가 LLM의 최종 생성 행동에 영향을 미치는 방식은 `safety_mode`에 따른 명확한 지시로 제어.
