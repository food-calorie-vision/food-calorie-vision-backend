# 레시피 추천 시스템 성능 개선 진행 기록 (Progress Record)

## 2025-11-28 (현재 진행 중)

### 1. 초기 접근: Mock 테스트
*   **시도**: LLM 추론 시간을 배제했을 때의 속도를 확인하기 위해 `RecipeRecommendationServiceMock` 및 `/mock` 라우트 구현.
*   **결과**: "응" 응답 후에도 여전히 수 초의 지연 발생.
*   **원인 분석**: 실제 레시피 생성(Generation) 전, **LangChain Agent가 사용자의 의도를 파악하고 툴을 선택하는 추론 과정(Reasoning)**에서 병목 발생.

### 2. 전략 수정: 백엔드 단축 경로 (Shortcut)
*   **목표**: "응", "네"와 같은 명확한 긍정 확답 시, 무거운 LangChain Agent 실행을 건너뛰고 바로 서비스 로직을 호출.
*   **계획**: `chat_v2.py`를 생성하여 `handle_chat_message` 내에 단축 경로 로직 구현.

### 3. 사용자 피드백 반영: 건강 체크 및 UX 강화
*   **피드백**: 무조건적인 속도 향상보다는 **건강 유해성 체크(선행)**와 **사용자 고지(UX)**가 중요함.
*   **수정된 프로세스 (6단계)**:
    1.  사용자 "응" 입력.
    2.  **[AI] 건강 유해성 체크 (`quick_analyze_intent`)** -> Agent 생략.
    3.  위험 감지 시 -> **[UI] 경고 팝업 (`HEALTH_CONFIRMATION`)**.
    4.  사용자 선택 -> `proceed` (그대로) vs `health_first` (건강하게).
    5.  **[AI] 맞춤 레시피 생성**.
*   **UX 개선**: 프론트엔드 로딩 메시지를 "건강 정보 확인 중..." 등으로 구체화하여 체감 대기 시간 개선.

### 4. 프롬프트 최적화 논의
*   **초기 아이디어**: `proceed` 모드일 때 건강 정보(Context)를 프롬프트에서 제외하여 토큰을 줄이자.
*   **피드백 및 수정**:
    *   이전 대화 맥락(Context)이나 사용자의 복합적인 의도가 무시될 수 있음.
    *   **결론**: 정보는 그대로 제공하되, **프롬프트 지시사항(Instruction)을 명확히 분기**하여 LLM이 "판단"하지 않고 "실행"만 하도록 유도.
    *   `_build_recipe_prompt` 내 중복된 지시사항(경고해라, 고려해라 등) 삭제.

## 향후 계획
*   `chat_v2.py` 구현 (단축 경로 + 건강 체크 선행).
*   `RecipeRecommendationService` 프롬프트 다이어트 및 최적화.
*   프론트엔드 로딩 메시지 업데이트.
