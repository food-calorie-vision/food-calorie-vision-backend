# 건강 점수 계산식 변경사항 문서

## 개요
건강 점수 계산식이 여러 번 개선되었습니다. 이 문서는 변경사항을 기록합니다.

## 최종 계산식 (현재 버전)

### 기본 구조
NRF9.3 (Nutrient Rich Food Index) 기반 계산식 사용

### 계산 단계

#### 1단계: 영양소 정규화
- 100g 기준으로 정규화
- 일일 권장량 대비 % 계산 (최대 100%로 캡)

#### 2단계: 기본 영양소 점수 계산
- **단백질**: 일일 권장량 대비 % × 0.6 (최대 60점)
- **식이섬유**: 일일 권장량 대비 % × 0.4 (최대 40점)
- 기본 점수 합계: 최대 100점

#### 3단계: 추가 영양소 보너스
- 비타민A, C, E, 칼슘, 철분, 칼륨, 마그네슘
- 있는 영양소들의 평균 × 가중치 × 0.3
- 최대 30점 보너스

#### 4단계: 제한 영양소 감점
- 포화지방, 첨가당, 나트륨
- 평균 × 0.15 (15%만 감점)

#### 5단계: 최종 점수 계산
```
raw_score = positive_score - (negative_score * 0.15)
```

#### 6단계: 최소 점수 보장
- 기본 영양소 합계 50점 이상: 최소 70점 보장
- 기본 영양소 합계 30점 이상: 최소 60점 보장
- 기본 영양소 합계 1점 이상: 최소 50점 보장

#### 7단계: 건강 식단 보너스
- 단백질 20% 이상 + 식이섬유 10% 이상: 최대 20점 보너스
- 단백질 15% 이상: 최대 15점 보너스

## 이전 계산식 (문제점)

### 문제점 1: 점수가 너무 낮게 나옴 (47-48점)
**원인:**
- 단백질 점수: `protein_score * 0.5` (최대 50점)
- 식이섬유 점수: `fiber_score * 0.3` (최대 30점)
- 기본 점수 합계가 낮아서 최종 점수도 낮음

**예시:**
- 단백질 30% → 15점
- 식이섬유 10% → 3점
- 기본 점수: 18점
- 최종 점수: 48점 (너무 낮음)

### 문제점 2: 건강 식단도 낮은 점수 (50-60점)
**원인:**
- 기본 영양소 점수가 낮게 계산됨
- 보너스 점수가 충분하지 않음
- 최소 점수 보장이 없음

## 개선 사항

### 1. 기본 영양소 점수 증가
- 단백질: 0.5배 → 0.6배 (최대 60점)
- 식이섬유: 0.3배 → 0.4배 (최대 40점)

### 2. 최소 점수 보장 추가
- 기본 영양소가 충분하면 최소 70점 보장
- 건강 식단이라면 더 높은 점수 확보

### 3. 건강 식단 보너스 추가
- 단백질과 식이섬유가 모두 충분하면 최대 20점 보너스
- 건강 식단이라면 70-85점 이상 가능

### 4. 제한 영양소 감점 완화
- 20% 감점 → 15% 감점
- 건강 식단에 유리하도록 조정

## 예상 점수 (개선 후)

### 건강 식단 예시 1: 단백질 30%, 식이섬유 15%
- 단백질 점수: 30 × 0.6 = 18점
- 식이섬유 점수: 15 × 0.4 = 6점
- 기본 점수: 24점 → 최소 70점 보장
- 건강 식단 보너스: (30+15)/3 = 15점
- **최종 점수: 85점**

### 건강 식단 예시 2: 단백질 25%, 식이섬유 12%
- 단백질 점수: 25 × 0.6 = 15점
- 식이섬유 점수: 12 × 0.4 = 4.8점
- 기본 점수: 19.8점 → 최소 70점 보장
- 건강 식단 보너스: (25+12)/3 = 12.3점
- **최종 점수: 82점**

### 일반 식단 예시: 단백질 20%, 식이섬유 5%
- 단백질 점수: 20 × 0.6 = 12점
- 식이섬유 점수: 5 × 0.4 = 2점
- 기본 점수: 14점 → 최소 50점 보장
- 단백질 보너스: 20/2 = 10점
- **최종 점수: 60점**

## 변경 이력

### 2024-11-19 (최종)
- 기본 영양소 점수 계산식 개선
- 건강 식단 최소 점수 보장 추가
- 건강 식단 보너스 추가
- 제한 영양소 감점 완화

### 2024-11-19 (이전)
- 기본 영양소 가중치 조정 시도
- 점수가 여전히 낮게 나옴

### 2024-11-19 (초기)
- NRF9.3 계산식 구현
- 기본 영양소 보정 시도
- 점수가 47-48점으로 낮게 나옴



